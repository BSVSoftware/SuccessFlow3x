<!DOCTYPE html>
<html>
<head>
   <title>SuccessFlow! Projekte</title>
   <script src="http://successflow.bsv.net//dhtmlx_gantt/dhtmlxgantt.js" type="text/javascript" charset="utf-8"></script>   
   <link href="http://successflow.bsv.net//dhtmlx_gantt/skins/dhtmlxgantt_meadow.css" rel="stylesheet">
   <script src="http://successflow.bsv.net/dhtmlx_gantt/locale/locale_de.js" charset="utf-8"></script>
   
   <style type="text/css" media="screen">
    html, body{
        margin:0px;
        padding:0px;
        height:100%;
        overflow:hidden;
    }
	.weekend{ 
		background: #b8b7b1
	}

</style>
</head>
<body>
    <div id="gantt_here" style='margin:0px; padding: 0px; width:100%; height:100%;'></div>
    <script language="javascript" type="text/javascript">

	
	var div = document.createElement("div");
        div.innerHTML = "<!--[if lt IE 9]><i></i><![endif]-->";
	var isIeLessThan9 = (div.getElementsByTagName("i").length == 1);
        if (isIeLessThan9) {
    alert("Zu alte Version von Internet Explorer!");
        }
	gantt.config.columns=[
		{name:"text", label:"Vorgaenge",tree:true,resize:true,width:300},
		{name:"start_date", label:"Startdatum",resize:true,min_width:100,align:"center"},
		{name:"end_date", label:"Zieldatum",resize:true,min_width:90,align:"center"},
		{name:"duration",width:60,resize:true,align:"center"},
		{name:"staff", label:"Mitarbeiter",width:100,resize:true,align:"center"},
		{name:"progress", label:"Status",width:60,resize:true,align:"center"},
<!--	{name:"add", label:"",width:30,align:"center"},-->
		{name:"task_daten", label:"TaskID;ProjektNr;KundenNr;VorgangGruppe;VorgangNr;MitarbeiterNr",hide:true},
		]
	gantt.config.keep_grid_width = true
	gantt.config.date_grid = "%d.%m.%Y"
	gantt.config.min_duration = 24*60*60*1000
	gantt.config.show_task_cells = false
	gantt.config.scale_unit = "day"
	gantt.config.date_scale = "%d %M"
	gantt.templates.scale_cell_class = function(date){
		if(date.getDay()==0||date.getDay()==6){
			return "weekend";
		}
	};
	gantt.config.subscales = [
		{unit:"month", step:1, date:"%F, %Y"}
	];
	
	gantt.config.lightbox.sections=[
		{name:"description", height:70, map_to:"text", type:"textarea", focus:true, readonly:true},
		{name:"time",        height:72, map_to:"auto", type:"duration"},
	];

	gantt.attachEvent("onTaskSelected", function(id){
		var mymsg=gantt.getTask(id).task_daten;
		sendmsg('task_daten:'+id+';'+mymsg);
		return true;
	});

//	gantt.attachEvent("onTaskDblClick", function(id){
//		var mymsg=gantt.getTask(id).task_daten;
//		sendmsg('task_dblclick:'+id+';'+mymsg);
//		return true;
//	});
	
	var tasks = {
	"data":[
		{"id":1, "text":"2163-AL Test 090322", "start_date":"09-03-2022", "duration":"85", "staff":"Loew, Andreas", "parent":"0", "progress": 0.00, "open": true,"task_daten":"2163;10100;;;3"},
		{"id":2, "text":"1. Vertrieb", "start_date":"31-03-2022", "duration":"8", "staff":"", "parent":"1", "progress": 0.00, "open": true,"task_daten":"2163;10100;1;;"},
		{"id":10, "text":"2. Innendienst", "start_date":"05-04-2022", "duration":"11", "staff":"", "parent":"1", "progress": 0.00, "open": true,"task_daten":"2163;10100;2;;"},
		{"id":14, "text":"3. Service", "start_date":"19-04-2022", "duration":"1", "staff":"", "parent":"1", "progress": 0.00, "open": true,"task_daten":"2163;10100;3;;"},
		{"id":3, "text":"1.1 Angebot abgeben / Auftrag", "start_date":"31-03-2022", "duration":"8", "staff":"", "parent":"2", "progress": 0.00, "open": true,"task_daten":"2163;10100;1;1;0"},
		{"id":8, "text":"1.2 Vertragsanlage", "start_date":"05-04-2022", "duration":"1", "staff":"", "parent":"2", "progress": 0.00, "open": true,"task_daten":"2163;10100;1;6;0"},
		{"id":11, "text":"2.1 Bestellung / Wareneingang", "start_date":"05-04-2022", "duration":"11", "staff":"", "parent":"10", "progress": 0.00, "open": true,"task_daten":"2163;10100;2;8;0"},
		{"id":15, "text":"3.1.Installation", "start_date":"19-04-2022", "duration":"1", "staff":"", "parent":"14", "progress": 0.00, "open": true,"task_daten":"2163;10100;3;11;0"},
		{"id":4, "text":"3.1.1 Konfiguration zusammenstellen und Preise erfragen", "start_date":"31-03-2022", "duration":"1", "staff":"", "parent":"3", "progress": 0.00, "open": true,"task_daten":"2163;10100;1;2;"},
		{"id":5, "text":"3.1.2 Angebot dem Kunden zusenden", "start_date":"01-04-2022", "duration":"1", "staff":"", "parent":"3", "progress": 0.00, "open": true,"task_daten":"2163;10100;1;3;"},
		{"id":6, "text":"3.1.3 Kunden nachfragen", "start_date":"06-04-2022", "duration":"1", "staff":"", "parent":"3", "progress": 0.00, "open": true,"task_daten":"2163;10100;1;4;"},
		{"id":7, "text":"3.1.4 Auftragsabschluß", "start_date":"04-04-2022", "duration":"1", "staff":"", "parent":"3", "progress": 0.00, "open": true,"task_daten":"2163;10100;1;5;"},
		{"id":9, "text":"1.2.1 Vertragsdaten in der EDV eintragen", "start_date":"05-04-2022", "duration":"1", "staff":"", "parent":"8", "progress": 0.00, "open": true,"task_daten":"2163;10100;1;7;"},
		{"id":12, "text":"2.1.1 Ware bestellen / kommissionieren", "start_date":"05-04-2022", "duration":"1", "staff":"", "parent":"11", "progress": 0.00, "open": true,"task_daten":"2163;10100;2;9;"},
		{"id":13, "text":"2.1.2 Wareneingang", "start_date":"15-04-2022", "duration":"1", "staff":"", "parent":"11", "progress": 0.00, "open": true,"task_daten":"2163;10100;2;10;"},
		{"id":16, "text":"3.1.1 Vorinstallation im Hause", "start_date":"19-04-2022", "duration":"1", "staff":"", "parent":"15", "progress": 0.00, "open": true,"task_daten":"2163;10100;3;12;"},
		{"id":17, "text":"3.1.2 Terminabsprache mit dem Kunden", "start_date":"19-04-2022", "duration":"19", "staff":"", "parent":"15", "progress": 0.00, "open": true,"task_daten":"2163;10100;3;13;"},
		{"id":19, "text":"3.1.4 Prüfung", "start_date":"01-06-2022", "duration":"1", "staff":"", "parent":"15", "progress": 0.00, "open": true,"task_daten":"2163;10100;3;15;"},
	],
	"links":[
		{"id":"1","source":"4","target":"5","type":"0"},
		{"id":"2","source":"5","target":"6","type":"0"},
		{"id":"3","source":"5","target":"7","type":"0"},
		{"id":"4","source":"7","target":"8","type":"0"},
		{"id":"5","source":"7","target":"11","type":"0"},
		{"id":"6","source":"7","target":"12","type":"0"},
		{"id":"7","source":"12","target":"13","type":"0"},
		{"id":"8","source":"11","target":"15","type":"0"},
		{"id":"9","source":"17","target":"18","type":"0"},
		{"id":"10","source":"18","target":"19","type":"0"},
	]
	};
		gantt.init("gantt_here");
		gantt.parse (tasks);

	
	function sendmsg(msg) {
			var iOS = ( navigator.userAgent.match(/(iPad|iPhone|iPod)/g) ? true : false ); var Win10 = ( navigator.userAgent.match(/(Windows Phone 10|Windows NT 10)/g) ? true : false ); 
			if( iOS ){window.location.href="MGExternalEvent:"+msg;}
			else if ( Win10 ) {window.MGExternalEvent(msg);}
			else {window.external.MGExternalEvent(msg);}
	};
	
   	function sf_updatetask (task_id,fulltask){
		var data_split=fulltask.split(';');
		var task_data=gantt.getTask(task_id);
		task_data.staff=data_split[3];
		gantt.updateTask(task_id);
		gantt.refreshData();
		};

		</script>
</body>
</html>
